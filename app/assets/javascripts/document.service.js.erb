(function(){

'use strict';

angular.module('GeoBox')
.service('DocumentService', DocumentService);

DocumentService.$inject = ['$http', '$rootScope'] //$resources or $http would likely go here.
function DocumentService($http, $rootScope){
	var doc_service = this;
	doc_service.docs = [];
	doc_service.books = [];

	doc_service.baseUrl = "<% if Rails.env.production? %>			\
							<%= 'https://geobox.herokuapp.com' %> 	\
						  <% else %>								\
						  	<%= 'http://localhost:3000' %> 			\
						  <% end %>".trim();

	doc_service.updateLocation = function(browser_lat, browser_lng){
		return $http({
			method: 'POST',
			url: doc_service.baseUrl + '/update_location',
			params: {
				lat: browser_lat,
				lng: browser_lng
			}
		})
		.then(function(response){
			doc_service.docs = response.data.filter(function(item){
				return !item.is_book;
			});
			doc_service.books = response.data.filter(function(item){
				return item.is_book;
			});
			console.log('documents', doc_service.docs);
			console.log('books', doc_service.books);
			$rootScope.$broadcast('documents:ready');
		})
		.catch(function(error){
			console.log(error);
		})
	}
}

})();
