<script src="//maps.google.com/maps/api/js?key=AIzaSyD2Gwxfy4O60gWgPwTFIrIW8zkK_46gHCw"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
<script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-1.3.3.js"></script>



<div id="sidebar" class="sidebar collapsed">
  <!-- Nav tabs -->
  <div class="sidebar-tabs">
    <ul role="tablist">
      <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
      <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
    </ul>

    <ul role="tablist">
      <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
    </ul>
  </div>

  <!-- Tab panes -->
  <div class="sidebar-content">
    <div class="sidebar-pane" id="home">
      <h1 class="sidebar-header">
        Files
        <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
      </h1>

      <div class="list-group">
        <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
          <div class="d-flex w-100 justify-content-between">
          <table>
            <% @documents.each do |document| %>
          <tr>
            <td><h5 class="mb-1"><%=link_to document.filename, document.cloudKey, data: { confirm: 'Are you sure you want to download?' }%></h5></td>
        </tr>
        <% end %>
        <tr>
          <td>
            <div ng-app="mySidebar" ng-controller="mySideCtrl">
  File Name: {{fileName}}

</div>
<script>
var app = angular.module("mySidebar", ['ui.bootstrap', [require('angular-resource')]]);

app.factory('Document', function($resource) {
  return $resource('//localhost:3000/dummy/:documents', { documents: '@documents'},
  {
   'Docget': { method: 'GET', isArray: true }
  });
});

app.controller('mySideCtrl', function($scope, Document) {
    $scope.documents = Document.index();
    $scope.fileName= documents.filename;
    });
</script>
          </td>
        </tr>
        </table>
        </div>
        </a>
      </div>

    </div>

    <div class="sidebar-pane" id="profile">
      <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
    </div>

    <div class="sidebar-pane" id="messages">
      <h1 class="sidebar-header">Messages<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
    </div>

    <div class="sidebar-pane" id="settings">
      <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
    </div>
  </div>
</div>

<div id="geolocation"></div>


<script >
    var handler = Gmaps.build('Google');
    handler.buildMap({ internal: {id: 'geolocation'} }, function(){
        // be aware chrome >= 50 requires https for geolocation to work
        if(navigator.geolocation)
            navigator.geolocation.getCurrentPosition(displayOnMap);
    });
    function displayOnMap(position){
        var marker = handler.addMarker({
            lat: position.coords.latitude,
            lng: position.coords.longitude
        });
        // TODO pass postion.coords lat and lng to UsersController
        handler.map.centerOn(marker);
    }
    var sidebar = $('#sidebar').sidebar();
</script>

<style>
  #geolocation {
    height: 100%;
    width: 100%;
    left: 0;
    position: relative;
    top: 0;
  }
</style>
